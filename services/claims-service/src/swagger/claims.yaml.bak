paths:
  /api/claims:
    get:
      tags:
        - Claims
      summary: Get all claims
      description: Retrieve a list of all insurance claims with optional filters
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
          description: Filter by claim status
        - name: policyId
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by policy ID
        - name: userId
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by user ID (customer)
        - name: incidentDateFrom
          in: query
          schema:
            type: string
            format: date
          description: Filter claims with incident date after this date
        - name: incidentDateTo
          in: query
          schema:
            type: string
            format: date
          description: Filter claims with incident date before this date
        - name: minClaimAmount
          in: query
          schema:
            type: number
          description: Minimum claim amount
        - name: maxClaimAmount
          in: query
          schema:
            type: number
          description: Maximum claim amount
        - name: search
          in: query
          schema:
            type: string
          description: Search by claim number or description (case-insensitive)
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
          description: Number of results per page
      responses:
        '200':
          description: List of claims retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Claim'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 50
                      total:
                        type: integer
                        example: 150
                      pages:
                        type: integer
                        example: 3
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    
    post:
      tags:
        - Claims
      summary: Create a new claim
      description: Submit a new insurance claim
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - policyId
                - claimNumber
                - claimDate
                - claimAmount
                - description
              properties:
                userId:
                  type: string
                  format: uuid
                  example: 123e4567-e89b-12d3-a456-426614174000
                policyId:
                  type: string
                  format: uuid
                  example: 987fcdeb-51a2-43f7-b890-123456789abc
                claimNumber:
                  type: string
                  example: CLM-2024-001234
                claimDate:
                  type: string
                  format: date
                  example: 2024-11-25
                claimAmount:
                  type: number
                  format: decimal
                  example: 5000.00
                description:
                  type: string
                  example: Car accident on highway - rear-end collision
                status:
                  type: string
                  enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
                  default: SUBMITTED
      responses:
        '201':
          description: Claim created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/claims/{id}:
    get:
      tags:
        - Claims
      summary: Get claim by ID
      description: Retrieve a specific claim's information
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID
      responses:
        '200':
          description: Claim retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
    
    put:
      tags:
        - Claims
      summary: Update claim
      description: Update claim status or information (Agent/Admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
                  description: New claim status
                claimAmount:
                  type: number
                  format: decimal
                  description: Updated claim amount
                description:
                  type: string
                  description: Updated claim description
      responses:
        '200':
          description: Claim updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
    
    delete:
      tags:
        - Claims
      summary: Delete claim
      description: Remove a claim from the system (Admin only)
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID
      responses:
        '200':
          description: Claim deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Claim deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/claims/{id}/status:
    put:
      tags:
        - Claims
      summary: Update claim status
      description: Update claim status with workflow validation (SUBMITTED → UNDER_REVIEW → APPROVED/DENIED → PAID). Creates history entry.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
                  example: APPROVED
                approvedAmount:
                  type: number
                  format: decimal
                  description: Required when status is APPROVED
                  example: 4500.00
                denialReason:
                  type: string
                  description: Required when status is DENIED
                  example: Claim not covered under policy terms
      responses:
        '200':
          description: Claim status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
        '400':
          description: Invalid status transition or missing required fields
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Invalid status transition from SUBMITTED to PAID
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /api/claims/{id}/history:
    get:
      tags:
        - Claims
      summary: Get claim status history
      description: Retrieve the complete history of status changes for a claim
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID
      responses:
        '200':
          description: Claim status history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClaimStatusHistory'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  responses:
    UnauthorizedError:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: Unauthorized
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: Validation failed
              errors:
                type: array
                items:
                  type: object
    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: Not found
    ForbiddenError:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              message:
                type: string
                example: Forbidden
  schemas:
    Claim:
      type: object
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        organizationId:
          type: string
          format: uuid
        policyId:
          type: string
          format: uuid
        claimNumber:
          type: string
        status:
          type: string
          enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
        incidentDate:
          type: string
          format: date
        description:
          type: string
        claimAmount:
          type: number
          format: decimal
        approvedAmount:
          type: number
          format: decimal
          nullable: true
        denialReason:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ClaimStatusHistory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        claimId:
          type: string
          format: uuid
        organizationId:
          type: string
          format: uuid
        oldStatus:
          type: string
          enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
          nullable: true
        newStatus:
          type: string
          enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
        changedBy:
          type: string
          format: uuid
        changedAt:
          type: string
          format: date-time
        reason:
          type: string
          nullable: true
        metadata:
          type: object
          nullable: true

  /api/claims/{id}/approve:
    post:
      tags:
        - Claims
        - Workflows
      summary: Approve claim
      description: |
        Approve a claim that is UNDER_REVIEW. This is a workflow action that:
        - Validates claim status is UNDER_REVIEW
        - Updates status to APPROVED
        - Records approved amount
        - Creates status history entry
        - Agent/Admin only
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID to approve
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - approvedAmount
              properties:
                approvedAmount:
                  type: number
                  format: decimal
                  example: 3200.00
                  description: Amount approved for payout
                reason:
                  type: string
                  example: Valid claim, approved with deductible
                  description: Optional reason for approval
      responses:
        '200':
          description: Claim approved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
                  message:
                    type: string
                    example: Claim approved successfully
        '400':
          description: Claim not in valid status for approval
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Only claims under review can be approved
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/claims/{id}/deny:
    post:
      tags:
        - Claims
        - Workflows
      summary: Deny claim
      description: |
        Deny a claim that is SUBMITTED or UNDER_REVIEW. This is a workflow action that:
        - Validates claim status
        - Updates status to DENIED
        - Records denial reason (required)
        - Creates status history entry
        - Agent/Admin only
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Claim UUID to deny
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  example: Incident occurred before policy start date
                  description: Required reason for denial
      responses:
        '200':
          description: Claim denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Claim'
                  message:
                    type: string
                    example: Claim denied
        '400':
          description: Claim not in valid status for denial or missing reason
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Only submitted or under-review claims can be denied
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'

  /api/claims/my/claims:
    get:
      tags:
        - Claims
        - User-Scoped
      summary: Get my claims
      description: |
        Retrieve claims for the authenticated user only. 
        Automatically filters by userId from JWT token.
        Supports same filtering/pagination as GET /claims but scoped to current user.
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [SUBMITTED, UNDER_REVIEW, APPROVED, DENIED, PAID]
          description: Filter by claim status
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            maximum: 100
          description: Number of results per page
      responses:
        '200':
          description: User claims retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Claim'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 50
                      total:
                        type: integer
                        example: 7
                      pages:
                        type: integer
                        example: 1
        '401':
          $ref: '#/components/responses/UnauthorizedError'
